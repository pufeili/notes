# 最小二乘法及代码实现

## 1 矩阵公式推导

最小二乘法最简单的理解就是 将预测的回归值与真实值的残差平方和达到最小[4]，即 $\min \sum_{i=1}^n\left(h_\theta\left(x_i\right)-y_i\right)^2$ ，假设函数 $h_\theta\left(x_1, x_2, \ldots x_n\right)=\theta_0+\theta_1 x_1+\ldots+\theta_n x_n$ ，则其矩阵表达方式为 $h_\theta(\mathbf{x})=\mathbf{X} \theta$ ，具体推导过程可以参考[1]。

## 2 `matlab` 代码实现

最小二乘法与多项式拟合[2]

```matlab
% 最小二乘法多项式拟合

% 原三次函数+随机噪声
f=@(x)x.^3+6.*x.^2-2.*x+4+(rand(size(x))-.5).*20;

% 构造原始数据
x=-5:.1:5;
y=f(x);

% 自己写一个最小二乘
n=3;% 最高次数为三次
X=(x').^(n:-1:0);
theta1=((X'*X)\X'*y')';

% MATLAB自带多项式拟合
theta2=polyfit(x,y,n);

% 输出对比
disp(theta1)
disp(theta2)

% theta1=0.9686 6.0178 -1.8845 4.3362
% theta2=0.9686 6.0178 -1.8845 4.3362

% 一个小技巧，下面的写法能够快速将
% 参数向量变成有关x的多项式匿名函数
func=matlabFunction(poly2sym(theta1));
```

对代码`n=3;X=(x').^(n:-1:0);`的解读：

> 该部分定义了一个自定义的最小二乘法。首先，将自变量`x`重新排列成一个 101×4101×4 的矩阵`X`，其中第`i`行的四个元素分别为$x_{i}^{3}, x_{i}^{2}, x_{i}^{1}, 1$，这样可以方便地用矩阵运算来求解回归系数。
>
> 最终得到的`theta1`是一个长度为`4`的向量，对应于三次多项式函数中的四个系数，即$x^3$前面的系数、$x^2$前面的系数、$x$前面的系数和常数项的系数。

对代码`theta1=((X'*X)\X'*y')';`的解读：

> 在 MATLAB 中，反斜杠符号 `\` 表示矩阵的左除法运算。具体来说，如果$A$ 和 $B$是两个大小相同的矩阵，且是$A$一个非奇异矩阵（即行列式不等于0），则 `X = A \ B` 表示求解下面的线性方程组：
> $$
> AX=B
> $$
> 其中，$X$是未知变量的矩阵，需要通过求解得到。实际上，MATLAB 内部会计算出$A$的逆矩阵，然后将其与$B$相乘，即$X=A^{-1}B$。
>
> 当$A$不是一个非奇异矩阵时，`A \ B` 运算会返回一个最小二乘解。这种情况在数据分析中经常出现，例如，在线性回归模型中可能存在多重共线性问题，导致矩阵$X^{T}X$不可逆。此时，使用 `A \ B` 求解可以得到一个在最小二乘意义下最接近真实解的伪逆解

## 3 References

1. [最小二乘法解的矩阵形式推导](http://t.csdn.cn/gewkm)
2. [MATLAB | 最小二乘法的两种解读与MATLAB实现](https://zhuanlan.zhihu.com/p/454585502)
3. [矩阵形式下的最小二乘法推导](https://zhuanlan.zhihu.com/p/87582571) 
4. [最小二乘法（least sqaure method)](https://zhuanlan.zhihu.com/p/38128785)

